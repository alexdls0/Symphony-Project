{"changed":true,"filter":false,"title":"capsule.php","tooltip":"/symfony4/public/news/wp-content/plugins/capsule.php","value":"<?php\n/*\n    Plugin Name: capsule\n    Plugin URI: www.capsule.org\n    Description: Crear el custom post type de capsule\n    Version: 1.0\n    Author: admin\n    License: GPL\n*/\n\n/*\n*\n*   Función para registrar el custom post type capsule\n*\n*/\n\nfunction registra_capsules(){\n    $supports = array(\n        'title', // post title\n        'editor', // post content\n        'author', // post author\n        'thumbnail', // featured images\n        'excerpt', // post excerpt\n        //'custom-fields', // custom fields\n        //'comments', // post comments\n        'revisions', // post revisions\n        //'post-formats', // post formats\n    );\n    $labels = array(\n        'name' => _x('Zapatos', 'plural'), // general name for the post type - usually plural (default = posts/pages)\n        'singular_name' => _x('Zapato', 'singular'), // name for one object of this post type\n        'menu_name' => _x('Zapatos', 'admin menu'), // Text for use in the admin area \n        'name_admin_bar' => _x('Zapato', 'admin bar'), // Text for use in the New option in admin area \n        'add_new' => _x('Añadir zapato', 'añadir zapato'), // The text for add new (default 'Add New')\n        \n        'add_new_item' => __('Añadir nuevo zapato'), // Text for add new item (default 'Add new post'/'Add new page')\n        'new_item' => __('Nuevo zapato'), // idem.\n        'edit_item' => __('Editar zapato'),  // idem.\n        'view_item' => __('Ver zapato'),// idem.\n        'all_items' => __('Todos los zapatos'),// idem.\n        'search_items' => __('Buscar Zapatos'),// idem.\n        'not_found' => __('Zapatos no encontrados.'),// idem.\n    );\n    $args = array(\n        'supports' => $supports,\n        'labels' => $labels,\n        'public' => true, // Controls how the type is visible to authors (show_in_nav_menus, show_ui) and readers (exclude_from_search, publicly_queryable). Default: false\n        'query_var' => true,\n        'rewrite' => array('slug' => 'zapato'),//especificar el slug del custom post type\n        'has_archive' => true, // Para que podamos usar la plantilla archive-{custom_post_type}.php   -->  no me funciona\n        'hierarchical' => false,\n        'menu_position' => 4, // The position in the menu order the post type should appear\n        'menu_icon' => 'dashicons-universal-access', //The url to the icon to be used for this menu or the name of the icon from the iconfont [1] Default: null - defaults to the posts icon\n        // EJEMPLO: 'get_template_directory_uri() . \"/images/cutom-posttype-icon.png\"' (Use a image located in the current theme)\n        //'taxonomies' => array('category'), //  \n    );\n    register_post_type('zapato', $args);\n}\n\nadd_action('init','registra_zapatos');\n\nfunction add_cat_panels(){\n    register_taxonomy_for_object_type('category','zapato');\n    register_taxonomy_for_object_type('post_tag','zapato');\n}\n\nadd_action('init','add_cat_panels');\n\nfunction crear_metabox(){\n    $screens = array('zapato');\n    foreach($screens as $screen){\n        add_meta_box('zapatos_meta',__('Valoración de Zapatos'),'zapatos_callback',$screen,'normal');\n    }\n}\n\nadd_action(add_meta_boxes,'crear_metabox');\n\nfunction zapatos_callback($post){\n    //Crear el campo nonce\n    wp_nonce_field('save_metabox','zapatos_nonce');\n    \n    //Recoger los valores de los campos\n    $recomendado = get_post_meta($post->ID,'recomendado',true);\n    $carac1 = get_post_meta($post->ID,'carac1',true);\n    $carac2 = get_post_meta($post->ID,'carac2',true);\n    $carac3 = get_post_meta($post->ID,'carac3',true);\n    $carac4 = get_post_meta($post->ID,'carac4',true);\n    $carac5 = get_post_meta($post->ID,'carac5',true);\n    $carac6 = get_post_meta($post->ID,'carac6',true);\n    $carac7 = get_post_meta($post->ID,'carac7',true);\n    $carac8 = get_post_meta($post->ID,'carac8',true);\n    $carac9 = get_post_meta($post->ID,'carac9',true);\n    $carac10 = get_post_meta($post->ID,'carac10',true);\n    $carac11 = get_post_meta($post->ID,'carac11',true);\n    $carac12 = get_post_meta($post->ID,'carac12',true);\n    $valoracion = get_post_meta($post->ID,'valoracion',true);\n    \n    \n    //Construir la estructura html\n    echo '<h2>Crítica<h2>';\n    \n    echo '<fieldset>';\n    echo '<br><label for=\"extras\"><h3>Forro</h3> </label><br>';\n    echo '<input type=\"checkbox\" id=\"aprieta\" name=\"carac1\" value=\"aprieta\" ';\n    if($carac1 =='aprieta'){\n        echo ' checked';\n    }\n    echo  '>No aprieta o roza <br>';\n    \n    echo '<input type=\"checkbox\" id=\"ortopedia\" name=\"carac2\" value=\"ortopedia\" ';\n    if($carac2 =='ortopedia'){\n        echo ' checked';\n    }\n    echo  '>Tiene variedad ortopédica<br>';\n    \n    echo '<input type=\"checkbox\" id=\"desgaste\" name=\"carac3\" value=\"desgaste\" ';\n    if($carac3 =='desgaste'){\n        echo ' checked';\n    }\n    echo  '>Exámenes biomecánicos de desgaste <br>';\n    \n    echo '<br><label for=\"extras\"><h3>Suela</h3> </label><br>';\n    echo '<input type=\"checkbox\" id=\"sujecion\" name=\"carac4\" value=\"sujecion\" ';\n    if($carac4 =='sujecion'){\n        echo ' checked';\n    }\n    echo  '>Rugosa para sujeción firme <br>';\n    \n    echo '<input type=\"checkbox\" id=\"presion\" name=\"carac5\" value=\"presion\" ';\n    if($carac5 =='presion'){\n        echo ' checked';\n    }\n    echo  '>Reparte uniformemente la presión <br>';\n    \n    echo '<input type=\"checkbox\" id=\"flexible\" name=\"carac6\" value=\"flexible\" ';\n    if($carac6 =='flexible'){\n        echo ' checked';\n    }\n    echo  '>Flexible <br>';\n    \n    echo '<br><label for=\"extras\"><h3>Plantilla</h3> </label><br>';\n    echo '<input type=\"checkbox\" id=\"transpiracion\" name=\"carac7\" value=\"transpiracion\" ';\n    if($carac7 =='transpiracion'){\n        echo ' checked';\n    }\n    echo  '>Transpiración adecuada <br>';\n    \n    echo '<input type=\"checkbox\" id=\"curvas\" name=\"carac8\" value=\"curvas\" ';\n    if($carac8 =='curvas'){\n        echo ' checked';\n    }\n    echo  '>Respeta las curvas del pie <br>';\n    \n    echo '<input type=\"checkbox\" id=\"comodo\" name=\"carac9\" value=\"comodo\" ';\n    if($carac9 =='comodo'){\n        echo ' checked';\n    }\n    echo  '>No es duro ni incómodo <br>';\n    \n    echo '<input type=\"checkbox\" id=\"horma\" name=\"carac10\" value=\"horma\" ';\n    if($carac10 =='horma'){\n        echo ' checked';\n    }\n    echo  '>Horma anatómica <br>';\n    \n    echo '<br><label for=\"extras\"><h3>Químicos</h3> </label><br>';\n    echo '<input type=\"checkbox\" id=\"olores\" name=\"carac11\" value=\"olores\" ';\n    if($carac11 =='olores'){\n        echo ' checked';\n    }\n    echo  '>Para reducir olores<br>';\n    \n    echo '<input type=\"checkbox\" id=\"transferencia\" name=\"carac12\" value=\"transferencia\" ';\n    if($carac12 =='transferencia'){\n        echo ' checked';\n    }\n    echo  '>Para evitar la transferencia de color<br>';\n    \n    echo '</fieldset>';\n     \n    echo '<br><br><fieldset>';\n    echo '<label for=\"recomendado\"><h3>Recomendado</h3> </label><br>';\n    echo '<input type=\"radio\" name=\"recomendado\" value=\"si\"';\n    if($recomendado=='si'){\n        echo ' checked';\n    }\n    echo  '>Sí<br>';\n    echo '<input type=\"radio\" name=\"recomendado\" value=\"no\"';\n    if($recomendado=='no'){\n        echo ' checked';\n    }\n    echo  '>No<br>';\n    echo '</fieldset><br>';\n    \n    echo '<br><fieldset>';\n    echo '<label for=\"valoracion\"><h3>Valoracion</h3></label><br>';\n    echo '<input type=\"number\" id=\"valoracion\" value=\"'.$valoracion.'\" name=\"valoracion\">';    \n    echo '</fieldset>';\n}\n\nfunction save_metabox($post_id){\n    //Comprobar el campo nonce\n    if(!isset($_POST['zapatos_nonce'])){\n        return;\n    }\n    \n    if(!wp_verify_nonce($_POST['zapatos_nonce'],'save_metabox')){\n        return;\n    }\n    \n    //Comprobar que el usuario tiene permisos\n    if(!current_user_can('edit_page',$post_id)){\n        return;\n    }\n    \n    if(!current_user_can('edit_post',$post_id)){\n        return;\n    }\n    \n    //Saneamos los campos antes de salvarlos\n    $recomendado = sanitize_text_field($_POST['recomendado']);\n    $valoracion = sanitize_text_field($_POST['valoracion']);\n    $carac1 = sanitize_text_field($_POST['carac1']);\n    $carac2 = sanitize_text_field($_POST['carac2']);\n    $carac3 = sanitize_text_field($_POST['carac3']);\n    $carac4 = sanitize_text_field($_POST['carac4']);\n    $carac5 = sanitize_text_field($_POST['carac5']);\n    $carac6 = sanitize_text_field($_POST['carac6']);\n    $carac7 = sanitize_text_field($_POST['carac7']);\n    $carac8 = sanitize_text_field($_POST['carac8']);\n    $carac9 = sanitize_text_field($_POST['carac9']);\n    $carac10 = sanitize_text_field($_POST['carac10']);\n    $carac11 = sanitize_text_field($_POST['carac11']);\n    $carac12 = sanitize_text_field($_POST['carac12']);\n    \n    //Actualizamos la BBDD\n    update_post_meta($post_id,'recomendado',$recomendado);\n    update_post_meta($post_id,'valoracion',$valoracion);\n    update_post_meta($post_id,'carac1',$carac1);\n    update_post_meta($post_id,'carac2',$carac2);\n    update_post_meta($post_id,'carac3',$carac3);\n    update_post_meta($post_id,'carac4',$carac4);\n    update_post_meta($post_id,'carac5',$carac5);\n    update_post_meta($post_id,'carac6',$carac6);\n    update_post_meta($post_id,'carac7',$carac7);\n    update_post_meta($post_id,'carac8',$carac8);\n    update_post_meta($post_id,'carac9',$carac9);\n    update_post_meta($post_id,'carac10',$carac10);\n    update_post_meta($post_id,'carac11',$carac11);\n    update_post_meta($post_id,'carac12',$carac12);\n    \n}\n\nadd_action('save_post','save_metabox');","undoManager":{"mark":11,"position":13,"stack":[[{"start":{"row":2,"column":17},"end":{"row":2,"column":23},"action":"remove","lines":["zapato"],"id":2},{"start":{"row":2,"column":17},"end":{"row":2,"column":18},"action":"insert","lines":["c"]},{"start":{"row":2,"column":18},"end":{"row":2,"column":19},"action":"insert","lines":["a"]},{"start":{"row":2,"column":19},"end":{"row":2,"column":20},"action":"insert","lines":["p"]},{"start":{"row":2,"column":20},"end":{"row":2,"column":21},"action":"insert","lines":["s"]},{"start":{"row":2,"column":21},"end":{"row":2,"column":22},"action":"insert","lines":["u"]},{"start":{"row":2,"column":22},"end":{"row":2,"column":23},"action":"insert","lines":["e"]},{"start":{"row":2,"column":23},"end":{"row":2,"column":24},"action":"insert","lines":["l"]}],[{"start":{"row":2,"column":23},"end":{"row":2,"column":24},"action":"remove","lines":["l"],"id":3},{"start":{"row":2,"column":22},"end":{"row":2,"column":23},"action":"remove","lines":["e"]}],[{"start":{"row":2,"column":22},"end":{"row":2,"column":23},"action":"insert","lines":["l"],"id":4},{"start":{"row":2,"column":23},"end":{"row":2,"column":24},"action":"insert","lines":["e"]}],[{"start":{"row":3,"column":20},"end":{"row":3,"column":29},"action":"remove","lines":["zapateria"],"id":5},{"start":{"row":3,"column":20},"end":{"row":3,"column":21},"action":"insert","lines":["c"]},{"start":{"row":3,"column":21},"end":{"row":3,"column":22},"action":"insert","lines":["a"]},{"start":{"row":3,"column":22},"end":{"row":3,"column":23},"action":"insert","lines":["p"]},{"start":{"row":3,"column":23},"end":{"row":3,"column":24},"action":"insert","lines":["s"]},{"start":{"row":3,"column":24},"end":{"row":3,"column":25},"action":"insert","lines":["u"]},{"start":{"row":3,"column":25},"end":{"row":3,"column":26},"action":"insert","lines":["l"]},{"start":{"row":3,"column":26},"end":{"row":3,"column":27},"action":"insert","lines":["e"]}],[{"start":{"row":4,"column":46},"end":{"row":4,"column":53},"action":"remove","lines":["zapatos"],"id":6},{"start":{"row":4,"column":46},"end":{"row":4,"column":47},"action":"insert","lines":["c"]},{"start":{"row":4,"column":47},"end":{"row":4,"column":48},"action":"insert","lines":["a"]},{"start":{"row":4,"column":48},"end":{"row":4,"column":49},"action":"insert","lines":["p"]},{"start":{"row":4,"column":49},"end":{"row":4,"column":50},"action":"insert","lines":["s"]},{"start":{"row":4,"column":50},"end":{"row":4,"column":51},"action":"insert","lines":["u"]},{"start":{"row":4,"column":51},"end":{"row":4,"column":52},"action":"insert","lines":["l"]},{"start":{"row":4,"column":52},"end":{"row":4,"column":53},"action":"insert","lines":["e"]}],[{"start":{"row":6,"column":12},"end":{"row":6,"column":21},"action":"remove","lines":["zapateria"],"id":7},{"start":{"row":6,"column":12},"end":{"row":6,"column":13},"action":"insert","lines":["a"]},{"start":{"row":6,"column":13},"end":{"row":6,"column":14},"action":"insert","lines":["d"]},{"start":{"row":6,"column":14},"end":{"row":6,"column":15},"action":"insert","lines":["m"]},{"start":{"row":6,"column":15},"end":{"row":6,"column":16},"action":"insert","lines":["i"]},{"start":{"row":6,"column":16},"end":{"row":6,"column":17},"action":"insert","lines":["n"]}],[{"start":{"row":12,"column":47},"end":{"row":12,"column":53},"action":"remove","lines":["zapato"],"id":8},{"start":{"row":12,"column":47},"end":{"row":12,"column":48},"action":"insert","lines":["c"]},{"start":{"row":12,"column":48},"end":{"row":12,"column":49},"action":"insert","lines":["a"]},{"start":{"row":12,"column":49},"end":{"row":12,"column":50},"action":"insert","lines":["p"]},{"start":{"row":12,"column":50},"end":{"row":12,"column":51},"action":"insert","lines":["s"]},{"start":{"row":12,"column":51},"end":{"row":12,"column":52},"action":"insert","lines":["u"]},{"start":{"row":12,"column":52},"end":{"row":12,"column":53},"action":"insert","lines":["l"]},{"start":{"row":12,"column":53},"end":{"row":12,"column":54},"action":"insert","lines":["e"]}],[{"start":{"row":16,"column":18},"end":{"row":16,"column":19},"action":"insert","lines":["c"],"id":9},{"start":{"row":16,"column":19},"end":{"row":16,"column":20},"action":"insert","lines":["a"]},{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"insert","lines":["p"]},{"start":{"row":16,"column":21},"end":{"row":16,"column":22},"action":"insert","lines":["s"]},{"start":{"row":16,"column":22},"end":{"row":16,"column":23},"action":"insert","lines":["u"]},{"start":{"row":16,"column":23},"end":{"row":16,"column":24},"action":"insert","lines":["e"]},{"start":{"row":16,"column":24},"end":{"row":16,"column":25},"action":"insert","lines":["l"]}],[{"start":{"row":16,"column":24},"end":{"row":16,"column":25},"action":"remove","lines":["l"],"id":10},{"start":{"row":16,"column":23},"end":{"row":16,"column":24},"action":"remove","lines":["e"]}],[{"start":{"row":16,"column":23},"end":{"row":16,"column":24},"action":"insert","lines":["l"],"id":11},{"start":{"row":16,"column":24},"end":{"row":16,"column":25},"action":"insert","lines":["e"]}],[{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"remove","lines":["z"],"id":12},{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"remove","lines":["a"]},{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"remove","lines":["p"]},{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"remove","lines":["a"]},{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"remove","lines":["t"]},{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"remove","lines":["o"]}],[{"start":{"row":24,"column":8},"end":{"row":24,"column":9},"action":"insert","lines":["/"],"id":13},{"start":{"row":24,"column":9},"end":{"row":24,"column":10},"action":"insert","lines":["/"]}],[{"start":{"row":29,"column":22},"end":{"row":29,"column":23},"action":"insert","lines":["C"],"id":14}],[{"start":{"row":29,"column":22},"end":{"row":29,"column":23},"action":"remove","lines":["C"],"id":15}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":4,"column":53},"end":{"row":4,"column":53},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1558336476563}